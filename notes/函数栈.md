## 函数栈
### 进程地址空间
低地址 addr

|代码段 .text .init等|
|--------|
|只读数据段 .rodata|
|读写数据段 .data .rss|
|堆 heap  地址增长方向 ↓ |
| |
|动态库加载区|
| |
|栈 stack 地址增长方向 ↑|
| |
|内核地址空间|

高地址 addr


### gdb disas 代码例子(x86_64)
```cpp
#include <stdio.h>
int test(int a, int b)
{
	int add = a + b;
	int mul = a * b;
	int div = a / ((b == 0)? 1 : b);
	int sub = a - b;

	int res = add + mul + div + sub;
	return res;
}

int main()
{
	int p1 = 5, p2=6;
	int res = test(p1,p2);
	printf("%d",res);
    return 0;
}
```

### 寄存器简介
#### IA32 寄存器
IA32寄存器通常包含8个通用寄存器，6个段寄存器，
|名称| 简介| 其他|
| --| -- | -- |
|EAX| 一般作为累加器(add)|还多用于函数返回值中，用于保存返回值 |
|EBX| 一般作为基地址寄存器(base)|
|ECX| 一般作为计数寄存器(count)|
|EDX| 一般用来存放数据(data)|
|ESP| 一般作为栈指针寄存器(stack pointer)|
|EBP| 一般作为基指针寄存器(base pointer)|
|ESI| 一般作为源变址寄存器(source index)|
|EDI| 一般作为目标变址寄存器(destinatin index)|

#### disas main
```x86asm
(gdb) disas main
Dump of assembler code for function main:
   0x00000000004007a3 <+0>:     push   %rbp
   0x00000000004007a4 <+1>:     mov    %rsp,%rbp
   0x00000000004007a7 <+4>:     sub    $0x10,%rsp
   0x00000000004007ab <+8>:     movl   $0x5,-0x4(%rbp)
   0x00000000004007b2 <+15>:    movl   $0x6,-0x8(%rbp)
   0x00000000004007b9 <+22>:    mov    -0x8(%rbp),%edx
   0x00000000004007bc <+25>:    mov    -0x4(%rbp),%eax
   0x00000000004007bf <+28>:    mov    %edx,%esi
   0x00000000004007c1 <+30>:    mov    %eax,%edi
   0x00000000004007c3 <+32>:    callq  0x400748 <_Z4testii>
   0x00000000004007c8 <+37>:    mov    %eax,-0xc(%rbp)
   0x00000000004007cb <+40>:    mov    -0xc(%rbp),%eax
   0x00000000004007ce <+43>:    mov    %eax,%esi
   0x00000000004007d0 <+45>:    mov    $0x40090c,%edi
   0x00000000004007d5 <+50>:    mov    $0x0,%eax
   0x00000000004007da <+55>:    callq  0x40059c <printf@plt>
   0x00000000004007df <+60>:    mov    $0x0,%eax
   0x00000000004007e4 <+65>:    leaveq 
   0x00000000004007e5 <+66>:    retq   
End of assembler dump.
```

#### disas test
```x86asm
(gdb) disas test
Dump of assembler code for function _Z4testii:
   0x0000000000400748 <+0>:     push   %rbp
   0x0000000000400749 <+1>:     mov    %rsp,%rbp
   0x000000000040074c <+4>:     mov    %edi,-0x24(%rbp)
   0x000000000040074f <+7>:     mov    %esi,-0x28(%rbp)
   0x0000000000400752 <+10>:    mov    -0x24(%rbp),%edx
   0x0000000000400755 <+13>:    mov    -0x28(%rbp),%eax
   0x0000000000400758 <+16>:    add    %edx,%eax
   0x000000000040075a <+18>:    mov    %eax,-0x4(%rbp)
   0x000000000040075d <+21>:    mov    -0x24(%rbp),%eax
   0x0000000000400760 <+24>:    imul   -0x28(%rbp),%eax
   0x0000000000400764 <+28>:    mov    %eax,-0x8(%rbp)
   0x0000000000400767 <+31>:    cmpl   $0x0,-0x28(%rbp)
   0x000000000040076b <+35>:    je     0x400772 <_Z4testii+42>
   0x000000000040076d <+37>:    mov    -0x28(%rbp),%ecx
   0x0000000000400770 <+40>:    jmp    0x400777 <_Z4testii+47>
   0x0000000000400772 <+42>:    mov    $0x1,%ecx
   0x0000000000400777 <+47>:    mov    -0x24(%rbp),%eax
   0x000000000040077a <+50>:    cltd   
   0x000000000040077b <+51>:    idiv   %ecx
   0x000000000040077d <+53>:    mov    %eax,-0xc(%rbp)
   0x0000000000400780 <+56>:    mov    -0x24(%rbp),%eax
   0x0000000000400783 <+59>:    sub    -0x28(%rbp),%eax
   0x0000000000400786 <+62>:    mov    %eax,-0x10(%rbp)
   0x0000000000400789 <+65>:    mov    -0x4(%rbp),%edx
   0x000000000040078c <+68>:    mov    -0x8(%rbp),%eax
   0x000000000040078f <+71>:    add    %eax,%edx
   0x0000000000400791 <+73>:    mov    -0xc(%rbp),%eax
   0x0000000000400794 <+76>:    add    %eax,%edx
   0x0000000000400796 <+78>:    mov    -0x10(%rbp),%eax
   0x0000000000400799 <+81>:    add    %edx,%eax
   0x000000000040079b <+83>:    mov    %eax,-0x14(%rbp)
   0x000000000040079e <+86>:    mov    -0x14(%rbp),%eax
   0x00000000004007a1 <+89>:    pop    %rbp
   0x00000000004007a2 <+90>:    retq   
End of assembler dump.
```